
{% extends "base.html" %}
{% block title %}Schedule a Job{% endblock %}
{% block content %}
    {% endblock %}

{% block scripts %}
<script>
    document.getElementById('schedule-job-form').addEventListener('submit', async function(event) {
        event.preventDefault();

        const form = event.target;
        const customerId = document.getElementById('customer_id').value;

        // --- FIX: Add client-side validation ---
        if (!customerId) {
            alert('Please select a customer before scheduling.');
            return;
        }

        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        const response = await fetch("{{ url_for('main.schedule_job') }}", {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data),
        });

        const result = await response.json();

        if (response.ok && result.success) {
            window.location.href = "{{ url_for('main.dashboard') }}";
        } else {
            alert('Error: ' + result.error);
        }
    });
</script>
{% endblock %}
